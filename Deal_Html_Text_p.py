# -*- coding: UTF-8 -*-
# 传进参数为str的HTML，对HTML中进行处理，提取页面中的有用文章
# @zf - 2017.9.15 改
# -*- coding: UTF-8 -*-
import re

import pymongo
from bs4 import BeautifulSoup as BS

import URL_ProfilePageText


def deal_html(HTML):
    # details_zz = Details_List["detailsPageText"]
    soup = BS(HTML, 'html.parser')
    # deal_Details = soup.find('body')
    # p_list = soup.find_all('p')
    # ['vds','vsd']
    p_list = re.findall('<p>(.*?)</p>', str(soup), re.S)
    if p_list:
        pp_list = []
        for pp in p_list:
            if "href" in pp:
                p_list.remove(pp)
                continue
            pp = "<p>" + pp + "<\p>"
            soup123 = BS(pp, 'html.parser')
            pp_list.append(soup123.text)
        p_str = "".join(pp_list)
        p_str = p_str.replace('<p>', '').replace('<\p>', '')
        p_str = p_str.replace(' ', '').replace('\n', '')
        # print(p_str)
    else:
        # print(deal_Details)
        deal_Details = re.sub('\n\n', '', str(HTML))
        Details_List = deal_Details.split("\n")
        deal_Details2 = []
        for list_1 in Details_List:  # 循环判断是否有中文符号并保留
            if "，" in str(list_1):
                deal_Details2.append(list_1)
            elif "。" in list_1:
                deal_Details2.append(list_1)
        deal_Details2 = str(deal_Details2)  # 数组转化为字符串
        dr = re.compile(r'</?\w+[^>]*>', re.S)
        deal_Details2 = re.sub(dr, '', deal_Details2)
        deal_Details2 = re.sub('<[^>]+>', '', deal_Details2)
        deal_Details2 = deal_Details2.replace('\\xa0', '').replace('[\'', '')
        deal_Details2 = deal_Details2.replace('\\t', '').replace('\']', '').replace('\\r', '')
        deal_Details2 = deal_Details2.replace('\\u3000', '').replace(" ", '').replace('\',\'', '')
        p_str = deal_Details2.replace('&nbsp', '')
        # print(p_str)
    return p_str


if __name__ == "__main__":
    HTML = "s@wencan.net ,www.wencan.net\" />\r\n<meta name=\"Copyright\" content=\"www.maweiship.com\" />\r\n<meta name=\"Description\" content=\"福建省马尾造船股份有限公司隶属福建省船舶工业集团公司，是福建省最大的造船企业。马尾造船厂创办于1866年(清同治五年)，时称福建船政，是中国最先建立的造船企业，作为我国民族工业的重要源头，她为近代中国舰船制造、海军建设、科技人才的培养，以及包括飞机制造等诸多工业领域的开拓，都做出令人瞩目的贡献。新中国成立后，马尾造船厂如枯木蓬春再度崛起，重新活跃于祖国的船舶工业战线。进入改革开放新的历史时期，马尾造船厂更是青春焕发全面振兴。以80年代初首次建造5000吨级货轮为开端，至90年代成批量生产符合欧洲标准的多用途集装箱货轮并挺进国际市场，工厂不断攀登新台阶，赢得了有史以来最好的发展局面。\" />\r\n<meta name=\"Keywords\" content=\"\" />\r\n<title>新闻中心-福建省马尾造船股份有限公司</title>\r\n\r\n<link rel=\"icon\" href=\"images/favicon.ico\" type=\"image/x-icon\" />\r\n<link rel=\"shortcut icon\" href=\"images/favicon.ico\" type=\"image/x-icon\" />\r\n<link href=\"css/public.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n<link href=\"css/insidePage.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n</head>\r\n\r\n<body oncontextmenu='return false'>\r\n\r\n\r\n<!--header begin-->\r\n<div class=\"wrap header\">\r\n\t<div class=\"fl\"><img src=\"images/topImg1.jpg\" alt=\"left\" /></div><div class=\"fr\"><img src=\"images/topImg2.jpg\" alt=\"right\" /></div>\r\n</div>\r\n<!--header end-->\r\n\r\n\r\n<!--top begin-->\r\n<div class=\"wrap top\">\r\n\t<!--logo-->\r\n    <div class=\"logo\"><a href=\"index.asp\">福建省马尾造船股份有限公司</a></div>\r\n    <!--logo-->\t\r\n    <!--百年传统、诚信为本 begin-->\r\n    <div class=\"adverType\">百年传统、诚信为本</div>\r\n\t<!--百年传统、诚信为本 end-->\r\n    <!--right quickMenu-->\r\n    <div class=\"rightBotton\">\r\n         <span class=\"language\"><a href=\"#\">[简体中文]</a>    　  <a href=\"#\">[ENGLISH]</a><br /></span>\r\n    \t<a href=\"javascript:window.external.AddFavorite('http://www.slam.com','福建省马尾造船股份有限公司')\">加入收藏</a> ｜ <a href=\"contactus.asp\">联系我们</a> ｜ <a href=\"#\">企业邮箱</a> <br />\r\n\t\t\r\n    </div>\r\n    <!--right menu-->\r\n</div>\r\n<!--top end-->\r\n\r\n<!--menu begin-->\r\n\r\n\r\n\r\n\r\n\r\n<!--menu begin-->\r\n\r\n<style>\r\n\r\n\r\n#sddm\r\n{\t\r\n\twidth:1000px; margin:0 auto;\r\n}\r\n\r\n#sddm li\r\n{\t\r\n\t}\r\n\r\n#sddm li a\r\n{\t}\r\n\r\n#sddm li a:hover\r\n{}\r\n\r\n#sddm li a.current\r\n{ }\r\n\r\n\r\n#sddm div\r\n{\tposition: absolute;\r\n\tvisibility: hidden;\r\n\tmargin: 0;\r\n\tpadding: 0;\r\n\tbackground: #1050b1;\r\n\tz-index:2;\r\n\t}\r\n\r\n\t#sddm div a\r\n\t{\tposition: relative;\r\n\t\tdisplay: block;\r\n\t\twhite-space: nowrap;\r\n\t\ttext-align: center;\r\n\t\ttext-decoration: none;\r\n\t\tcolor: #fff;\r\n\t\tline-height:26px;\r\n\t\theight:26px;\r\n\t\tfont-size:12px;\r\n\t\tborder-bottom: 1px solid #a7c5f2\r\n\t\t\r\n\t\t}\r\n\r\n\t#sddm div a:hover\r\n\t{\t\r\n\t\tline-height:26px;\r\n\t\theight:26px;\r\n\t\tcolor: #1050b1;\r\n\t\tbackground: #dbe9fe;\r\n\t\t}\r\n</style>\r\n<!-- dd menu -->\r\n<script type=\"text/javascript\">\r\n<!--\r\nvar timeout         = 500;\r\nvar closetimer\t\t= 0;\r\nvar ddmenuitem      = 0;\r\n\r\n// open hidden layer\r\nfunction mopen(id)\r\n{\t\r\n\t// cancel close timer\r\n\tmcancelclosetime();\r\n\r\n\t// close old layer\r\n\tif(ddmenuitem) ddmenuitem.style.visibility = 'hidden';\r\n\r\n\t// get new layer and show it\r\n\tddmenuitem = document.getElementById(id);\r\n\tddmenuitem.style.visibility = 'visible';\r\n\r\n}\r\n// close showed layer\r\nfunction mclose()\r\n{\r\n\tif(ddmenuitem) ddmenuitem.style.visibility = 'hidden';\r\n}\r\n\r\n// go close timer\r\nfunction mclosetime()\r\n{\r\n\tclosetimer = window.setTimeout(mclose, timeout);\r\n}\r\n\r\n// cancel close timer\r\nfunction mcancelclosetime()\r\n{\r\n\tif(closetimer)\r\n\t{\r\n\t\twindow.clearTimeout(closetimer);\r\n\t\tclosetimer = null;\r\n\t}\r\n}\r\n\r\n// close layer when click-out\r\ndocument.onclick = mclose; \r\n// -->\r\n</script>\r\n\r\n\r\n\r\n\r\n\r\n\r\n<div class=\"wrap menu\">\r\n <!--\r\n    <ul>\t\r\n        <li><a href=\"index.asp\" >网站首页</a></li>                                                \r\n        <li><img src=\"images/menuX.jpg\" alt=\"x\" /></li>\r\n        <li><a href=\"aboutus.asp\" >企业概况</a></li>\r\n        <li><img src=\"images/menuX.jpg\" alt=\"x\" /></li>\r\n        <li><a href=\"news.asp\"  class=\"current\">新闻中心</a></li>\r\n        <li><img src=\"images/menuX.jpg\" alt=\"x\" /></li>\r\n        <li><a href=\"product.asp\" >产品风采</a></li>\r\n        <li><img src=\"images/menuX.jpg\" alt=\"x\" /></li>\r\n        <li><a href=\"business.asp\"  >修船业务</a></li>\r\n        <li><img src=\"images/menuX.jpg\" alt=\"x\" /></li>\r\n        <li><a href=\"http://www.maweiship.com/price/caigou.aspx\" >采购招标</a></li>\r\n        <li><img src=\"images/menuX.jpg\" alt=\"x\" /></li>\r\n        <li><a href=\"../caigou.aspx\" >废旧拍卖</a></li>\r\n        <li><img src=\"images/menuX.jpg\" alt=\"x\" /></li>\r\n        <li><a href=\"job.asp\"  >招贤纳才</a></li>\r\n        <li><img src=\"images/menuX.jpg\" alt=\"x\" /></li>\r\n        <li><a href=\"contactus.asp\"  >联系我们</a></li>\r\n        <li><img src=\"images/menuX.jpg\" alt=\"x\" /></li>\r\n       </ul>\r\n  \r\n   -->\r\n  \r\n  \r\n  \r\n  \r\n<ul id=\"sddm\">\r\n\t<li><a target=\"_top\" href=\"index.asp\"    onmouseover=\"mopen('m1')\" onmouseout=\"mclosetime()\">网站首页</a>\r\n   \r\n\t\t<div id=\"m1\" onmouseover=\"mcancelclosetime()\" onmouseout=\"mclosetime()\">\r\n         <!--\r\n\t\t<a href=\"#\">HTML DropDown</a>\r\n\t\t<a href=\"#\">DHTML DropDown menu</a>\r\n\t\t<a href=\"#\">JavaScript DropDown</a>\r\n\t\t<a href=\"#\">DropDown Menu</a>\r\n\t\t<a href=\"#\">CSS DropDown</a>\r\n          --> \r\n\t\t</div>\r\n     \r\n\t</li>\r\n    <li><img src=\"images/menuX.jpg\" alt=\"x\" /></li>\r\n\t<li><a target=\"_top\" href=\"aboutus.asp\"   onmouseover=\"mopen('m2')\" onmouseout=\"mclosetime()\">企业概况</a>\r\n   \r\n\t\t<div id=\"m2\" onmouseover=\"mcancelclosetime()\" onmouseout=\"mclosetime()\">\r\n\t\t<a target=\"_top\" href=\"aboutus.asp?ID=26\">企业简介</a>\r\n\t\t<a target=\"_top\" href=\"aboutus.asp?ID=20\">组织结构</a>\r\n\t\t<a target=\"_top\" href=\"aboutus.asp?ID=21\">企业荣誉</a>\r\n\t\t<a target=\"_top\" href=\"aboutus.asp?ID=31\">发展规划</a>\r\n\t\t<a target=\"_top\" href=\"aboutus.asp?ID=32\">企业文化</a>\r\n\t\t<a target=\"_top\" href=\"aboutus.asp?ID=33\">生产设备</a>\r\n\t\t</div>\r\n       \r\n\t</li>\r\n    <li><img src=\"images/menuX.jpg\" alt=\"x\" /></li>\r\n\t<li><a target=\"_top\" href=\"news.asp\"  class=\"current\"  onmouseover=\"mopen('m3')\" onmouseout=\"mclosetime()\">新闻中心</a>\r\n    \r\n\t\t<div id=\"m3\" onmouseover=\"mcancelclosetime()\" onmouseout=\"mclosetime()\">\r\n\t\t<a target=\"_top\" href=\"news.asp?ClassId=1\">企业公告</a>\r\n\t\t<a target=\"_top\" href=\"news.asp?ClassId=3\">企业新闻</a>\r\n        <a target=\"_top\" href=\"news.asp?ClassId=15\">行业动态</a>\r\n\t\t</div>\r\n      \r\n\t</li>\r\n    <li><img src=\"images/menuX.jpg\" alt=\"x\" /></li>\r\n\t<li><a target=\"_top\" href=\"product.asp\"   onmouseover=\"mopen('m4')\" onmouseout=\"mclosetime()\">产品风采</a>\r\n\r\n\t\t<div id=\"m4\" onmouseover=\"mcancelclosetime()\" onmouseout=\"mclosetime()\">\r\n\t\t<a target=\"_top\" href=\"product.asp?ClassId=1\">集装箱船</a>\r\n\t\t<a target=\"_top\" href=\"product.asp?ClassId=3\">散 货 船</a>\r\n        <a target=\"_top\" href=\"product.asp?ClassId=4\">油 轮</a>\r\n\t\t<a target=\"_top\" href=\"product.asp?ClassId=12\">驳 船</a>\r\n        <a target=\"_top\" href=\"product.asp?ClassId=13\">作业船/拖船/供应船</a>\r\n\t\t<a target=\"_top\" href=\"product.asp?ClassId=14\">滚装船</a>\r\n        <a target=\"_top\" href=\"product.asp?ClassId=15\">其他</a>\r\n        \r\n\t\t</div>\r\n\t</li>\r\n    <li><img src=\"images/menuX.jpg\" alt=\"x\" /></li>\r\n\t<li><a target=\"_top\" href=\"business.asp\"    onmouseover=\"mopen('m5')\" onmouseout=\"mclosetime()\">修船业务</a>\r\n   \r\n\t\t<div id=\"m5\" onmouseover=\"mcancelclosetime()\" onmouseout=\"mclosetime()\">\r\n\t\t<a target=\"_top\" href=\"business.asp?ID=26\">修船简介</a>\r\n\t\t<a target=\"_top\" href=\"business.asp?ID=36\">修船动态</a>\r\n\t\t</div>\r\n       \r\n\t</li>\r\n    <li><img src=\"images/menuX.jpg\" alt=\"x\" /></li>\r\n\t<li><a target=\"_top\" href=\"http://120.35.3.185:8115/web/index.aspx\"  onmouseover=\"mopen('m6')\" onmouseout=\"mclosetime()\">采购招标</a>\r\n\t    <div id=\"m6\" onmouseover=\"mcancelclosetime()\" onmouseout=\"mclosetime()\">\r\n\t    </div>\r\n\t</li>\r\n\r\n    <li style=\"display:none;\"><img src=\"images/menuX.jpg\" alt=\"x\" /></li>\r\n\t<li style=\"display:none;\"><a target=\"_top\" href=\"http://www.maweiship.com:8120/caigou.aspx\" target=\"_blank\" onmouseover=\"mopen('m7')\" onmouseout=\"mclosetime()\">废旧拍卖</a>\r\n    \t\r\n\t\t<div id=\"m7\" onmouseover=\"mcancelclosetime()\" onmouseout=\"mclosetime()\">\r\n\t        <!--\r\n\t\t<a href=\"TradsList.aspx\">挂牌交易</a>\r\n\t\t<a href=\"#\">现货行情</a>\r\n        \t-->\r\n\t\t</div>   \r\n        </li>\r\n\r\n    <li><img src=\"images/menuX.jpg\" alt=\"x\" /></li>\r\n\t<li><a target=\"_top\" href=\"job.asp\"   onmouseover=\"mopen('m8')\" onmouseout=\"mclosetime()\">招贤纳才</a>\r\n\t\r\n        <div id=\"m8\" onmouseover=\"mcancelclosetime()\" onmouseout=\"mclosetime()\">\r\n        <!--\r\n\t\t<a href=\"Service.aspx?cid=24\">常用表格</a>\r\n\t\t<a href=\"Service.aspx?cid=25\">交收仓库信息</a>\r\n\t\t<a href=\"Service.aspx?cid=26\">质检机构</a>\r\n        -->\r\n\t\t</div>\r\n        \t\r\n\t</li>\r\n    <li><img src=\"images/menuX.jpg\" alt=\"x\" /></li>\r\n\t<li><a target=\"_top\" href=\"contactus.asp\"   onmouseover=\"mopen('m9')\" onmouseout=\"mclosetime()\">联系我们</a>\r\n\r\n\t\t<div id=\"m9\" onmouseover=\"mcancelclosetime()\" onmouseout=\"mclosetime()\">\r\n\t\t<a target=\"_top\" href=\"contactus.asp\">联系方式</a>\r\n\t\t<a target=\"_top\" href=\"message.asp\">信息反馈</a>\r\n        \r\n\t\t</div>\r\n    \r\n\t</li>\r\n   \r\n   <!--  <li><img src=\"images/menuX.jpg\" alt=\"x\" /></li>\r\n\t<li><a href=\"Contact.aspx\" onmouseover=\"mopen('m11')\" onmouseout=\"mclosetime()\">联系我们</a>\r\n  \r\n\t\t<div id=\"m11\" onmouseover=\"mcancelclosetime()\" onmouseout=\"mclosetime()\">\r\n\t\t<a href=\"Contact.aspx\">联系方式</a>\r\n\t\t<a href=\"#\">在线留言</a>\r\n\t\t</div>\r\n  \r\n\t</li>  -->\r\n    \r\n    <!--  <li><img src=\"images/menuX.jpg\" alt=\"x\" /></li>\r\n\t<li><a target=\"_top\" href=\"../price/caigou.aspx\"  onmouseover=\"mopen('m6')\" onmouseout=\"mclosetime()\" style=\"color:red;\">旧招标入口</a>\r\n\t\t<div id=\"m6\" onmouseover=\"mcancelclosetime()\" onmouseout=\"mclosetime()\">        \r\n\t\t</div>\r\n\t</li>  -->\r\n\r\n</ul>\r\n        \r\n  \r\n  \r\n  \r\n  \r\n  \r\n  \r\n  \r\n  \r\n  \r\n  \r\n  \r\n  \r\n  \r\n  \r\n  \r\n</div>\r\n<!--menu end-->\r\n\r\n\r\n<!--banner-->\r\n<div class=\"wrap banner\">\r\n\t<img src=\"images/newsBanner.jpg\" alt=\"新闻中心\" />\r\n</div>\r\n<!--banner-->\r\n\r\n\r\n\r\n\r\n<!--content-->\r\n<div class=\"wrap content\">\r\n\r\n    <div class=\"totalTitle\">\r\n      <div class=\"cn\">新闻中心</div>\r\n      <div class=\"en\">News</div>\r\n    </div>\r\n\r\n\r\n\t<!--left-->\r\n    <div class=\"fl left\">\r\n\t\t<!--left Menu begin-->\r\n        <div class=\"leftmenu\">\r\n            <ul><li><a href='news.asp?ClassId=1' >企业公告</a></li><li><a href='news.asp?ClassId=3' >企业新闻</a></li><li><a href='news.asp?ClassId=15' >行业动态</a></li></ul>\r\n        </div>\r\n        <!--left Menu end-->\r\n        \r\n       <form name='sh' action='news.asp' method='get' style='border:0'>  <!--left search begin-->  <div class=\"leftSearch\">        \t<div class=\"serachTitle\">站内搜索</div>            <div class=\"searchList\"><input size=\"14\" name=\"sname\" /> <input type=image src=\"images/searchBtn.jpg\" alt=\"点击搜索\" /></div>   <input type='hidden' name='Search_s' value='Search'/>    </div>        <!--left search end--></form                    </div>    <!--left-->\r\n    </div>\r\n\t<!--left-->\r\n\r\n\r\n    <!--right-->\r\n    <div class=\"fr right\">\r\n\r\n\t   <table width='100%' border='0' cellspacing='0' cellpadding='0'><tr><td>  <div class='title' style='text-align:center;'>集团总会计师李永忠至公司调研指导财务工作</div></td></tr><tr><td align='center'   class='info'>来源：本站　点击数：<font color=red>115</font>次　更新时间：2017/8/21 15:42:13</td></tr><tr><td > <div class='contentShow'><p style=\"text-align: center\"><img alt=\"\" width=\"600\" height=\"450\" src=\"/Upload/20178211542463403.jpg\" /></p><p><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 本报讯</strong>&nbsp; 8月17日下午，集团公司党委委员、总会计师李永忠轻车简从，与资金财务部黄晓红处长及卢梅珍副处长至公司就财务工作进行专题调研指导。公司财务总监李柳根组织财务管理部领导及主办等8人汇报工作。<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 会上，公司就资金管理、会计核算、会计基础、风险管控、团队建设等方面进行了汇报。大家集思广益，畅所欲言，共同为公司乃至船舶集团的财务工作献计献策，气氛活跃而融洽。在调研讨论过程中，集团公司黄处长和卢副处长针对会上提出的工作问题一一作出解答，并表示将采纳调研会上大家对船舶财务工作的意见及建议，对马尾造船继续保持对工作的热情及积极性，共同建设好船舶集团的财务工作表达了殷切的期许；她们肯定了公司财务会计工作的所取得的成绩与效果，并告诫各位要不骄不躁，继续努力做好下半年的各项工作。<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 李永忠总会计师在会上作总结发言时指出，公司的财务会计工作在船舶集团系统内做得较好，同时也指出公司财务管理部目前所面临的市场不景气导致资金困难及企业搬迁导致的人才流失等问题，要求财务管理部所有成员要团结协作，迎难而上，全力以赴保证资金链的安全。他还对大家做好财务会计工作提出以下四个方面的要求：一是加强团队及核心队伍建设，营造团结、融洽向上的工作氛围；二是认真履行资金管理、财务核算、会计基础、风险管控的工作及会计监督职责；三是加强学习，提高自身专业素养以适应政策和会计信息化发展的要求；四是自觉遵守廉洁准则,切实增强自律意识。<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; （财务管理部&nbsp; 李丽琴）<br />&nbsp;</p></div></td></tr>     \r\n       <div id=\"clear\"></div>\r\n     \r\n    </div>\r\n    <!--right-->\r\n</div>  \r\n\r\n\r\n<!--content-->\r\n\r\n\r\n<!--bottom-->\r\n<div id=\"clear\"></div>\r\n<div class=\"wrap bottom\">\r\n    <div class=\"bottomMenu\"><a href=\"aboutus.asp\">公司简介</a>　｜　<a href=\"map.asp\">网站地图</a>　｜　<a href=\"contactus.asp\">联系方式</a>　｜　<a href=\"aboutus.asp\">企业荣誉</a> 　｜　<a href=\"http://www.maweiship.com:8077/mailbox/?sendto=zjl\">总经理信箱</a> 　｜　<a href=\"http://www.maweiship.com:8077/mailbox/?sendto=jwsj\">纪委信箱</a> </div>\t\t\r\n    <div class=\"copyright\">福建省马尾造船股份有限公司&copy;版权所有(2002-2014) 闽ICP备07058465号&nbsp;&nbsp;&nbsp;&nbsp;<img width=16 height=16 src=\"http://img1.cache.netease.com/f2e/www/index2014/images/ghs.png\"/>&nbsp;闽公网安备35010502000013号<br />\r\n通讯地址：福建省福州市\r\n连江县g头镇粗芦岛船政大道1号   邮编：350501   电话： 0591-83682412 传真： 0591-83682198  E-mail: information@maweiship.com\r\n　\r\n    </div>\r\n</div>\r\n<!--bottom-->\r\n\r\n</body>\r\n</html>\r\n"
    link = ()
    # conn = pymongo.MongoClient('172.25.254.17', 27017)
    conn = pymongo.MongoClient('localhost:27017', 27017)
    db = conn["eTensorDB"]
    _table = db["Company_News_From_KeyWord_zaochuanchang"]

    for url in _table.find():
        url = url["New_URL"]
        print(url)
        HTML = URL_ProfilePageText.DetailsPage(url)
        deal_html(HTML)
